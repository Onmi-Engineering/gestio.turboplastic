<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Para albaranes NO finalizados (estado != done) -->
    <template id="report_delivery_document_inherit_ler_pending" inherit_id="stock.report_delivery_document">
        <!-- Añadir cabecera LER en la tabla de movimientos pendientes -->
        <xpath expr="//table[@name='stock_move_table']//thead/tr/th[@name='th_sm_product']" position="after">
            <th name="th_sm_ler_code"><strong>Código LER</strong></th>
        </xpath>

        <!-- Añadir valor LER en cada línea de movimientos pendientes -->
        <xpath expr="//table[@name='stock_move_table']//tbody/tr//td[1]" position="after">
            <td name="td_sm_ler_code">
                <span t-field="move.ler_code"/>
            </td>
        </xpath>
    </template>

    <!-- Para albaranes finalizados (estado = done) -->
    <template id="report_delivery_document_inherit_ler_done" inherit_id="stock.report_delivery_document">
        <!-- Añadir cabecera LER en la tabla de líneas de movimiento -->
        <xpath expr="//table[@name='stock_move_line_table']//thead/tr/th[@name='th_sml_product']" position="after">
            <th name="th_sml_ler_code"><strong>Código LER</strong></th>
        </xpath>
    </template>

    <!-- Para líneas con número de serie -->
    <template id="stock_report_delivery_has_serial_move_line_inherit_ler" inherit_id="stock.stock_report_delivery_has_serial_move_line">
        <xpath expr="//td[1]" position="after">
            <td name="td_sml_ler_code">
                <span t-field="move_line.product_id.product_tmpl_id.ler_code"/>
            </td>
        </xpath>
    </template>

    <!-- Para líneas agregadas (sin serial number) -->
    <template id="stock_report_delivery_aggregated_move_lines_inherit_ler" inherit_id="stock.stock_report_delivery_aggregated_move_lines">
        <xpath expr="//tr//td[1]" position="after">
            <td name="td_aggregated_ler_code">
                <span t-esc="aggregated_lines[line].get('ler_code', '')"/>
            </td>
        </xpath>
    </template>
</odoo>